# ğŸš€ User Management API Framework

A robust Node.js Express API with JWT authentication, role-based access control, and comprehensive user management features.

## ğŸ“‹ Table of Contents
- [Features](#features)
- [Quick Start](#quick-start)
- [API Endpoints](#api-endpoints)
- [Authentication](#authentication)
- [Database Schema](#database-schema)
- [Testing](#testing)
- [Project Structure](#project-structure)
- [Environment Configuration](#environment-configuration)
- [Development](#development)

## âœ¨ Features

- ğŸ” **JWT Authentication** with configurable expiration
- ğŸ‘¥ **Role-Based Access Control** (User/Admin)
- ğŸ›¡ï¸ **Password Security** with bcrypt hashing
- ğŸ—„ï¸ **MySQL Database** with connection pooling
- ğŸ“Š **User Points System** with sorting capabilities
- ğŸ§ª **Comprehensive Testing** with Mocha, Chai, Sinon
- ğŸ”’ **Protected Routes** with middleware
- ğŸŒ **CORS Enabled** for cross-origin requests

## ğŸš€ Quick Start

### Prerequisites
- Node.js (v20 or higher)
- MySQL database
- npm or yarn

### Installation

1. **Clone and install dependencies**
```bash
npm install
```

2. **Set up environment variables**
```bash
cp .env.sample .env
# Edit .env with your database credentials and JWT secret
```

3. **Database setup**
```sql
CREATE TABLE `users` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `email` varchar(100) NOT NULL,
  `points` int NOT NULL DEFAULT '0',
  `password` varchar(255) NOT NULL,
  `role` enum('user','admin') DEFAULT 'user',
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  UNIQUE KEY `email` (`email`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
```

4. **Start the server**
```bash
yarn start
```

## ğŸ“¡ API Endpoints

### ğŸ”“ Public Routes

#### Register New User
```bash
curl -X POST http://localhost:3000/api/v1/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "alice",
    "email": "alice@example.com",
    "password": "password123"
  }'
```

#### User Login
```bash
curl -X POST http://localhost:3000/api/v1/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "alice@example.com",
    "password": "password123"
  }'
```

### ğŸ”’ Protected User Routes

#### Get All Users
```bash
curl http://localhost:3000/api/v1/users \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### Get Sorted Users
```bash
# Descending order (default)
curl "http://localhost:3000/api/v1/sortedusers" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# Ascending order
curl "http://localhost:3000/api/v1/sortedusers?order=asc" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### ğŸ‘‘ Admin Routes

#### Get All Users (Admin View)
```bash
curl http://localhost:3000/api/v1/admin/users \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

#### Update User Points
```bash
curl -X PUT http://localhost:3000/api/v1/admin/users/8/points \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"points": 150}'
```

#### Delete User
```bash
curl -X DELETE http://localhost:3000/api/v1/admin/users/8 \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

## ğŸ” Authentication

### JWT Token Flow
1. **Register/Login** to receive JWT token
2. **Include token** in request headers: `Authorization: Bearer <token>`
3. **Access protected routes** based on user role

### Token Structure
```json
{
  "id": 7,
  "username": "admin",
  "email": "admin@example.com",
  "role": "admin",
  "iat": 1764249055,
  "exp": 1764335455
}
```

## ğŸ§ª Testing

Run the comprehensive test suite:
```bash
npm run test:mocha
```

### Test Coverage
- âœ… Authentication middleware
- âœ… Route protection
- âœ… Role-based access control
- âœ… Database operations
- âœ… Error handling

## ğŸ“ Project Structure

```
server2/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ db.js                 # Database connection pool
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.js              # JWT authentication
â”‚   â””â”€â”€ adminAuth.js         # Admin role verification
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ authService.js       # Authentication logic
â”‚   â””â”€â”€ userService.js       # User business logic
â”œâ”€â”€ test/
â”‚   â””â”€â”€ integration/         # Comprehensive test suite
â”œâ”€â”€ index.js                 # Main application entry
â”œâ”€â”€ package.json             # Dependencies and scripts
â””â”€â”€ .env                     # Environment variables
```

## âš™ï¸ Environment Configuration

```sh
copy .env.sample .env
```
and populate the file

## ğŸ› ï¸ Development

### Scripts
```bash
npm install
npm start          # Start development server with nodemon
npm run test:mocha # Run test suite
```

### Dependencies
- **express** - Web framework
- **mysql2** - MySQL database client
- **jsonwebtoken** - JWT authentication
- **bcryptjs** - Password hashing
- **cors** - Cross-origin resource sharing
- **dotenv** - Environment variable management

### Development Dependencies
- **mocha** - Test framework
- **chai** - Assertion library
- **sinon** - Test spies and stubs
- **supertest** - HTTP testing
- **nodemon** - Development server

## ğŸ”§ Framework Features

### Security
- JWT tokens with configurable expiration
- Password hashing with bcrypt
- SQL injection protection via parameterized queries
- Role-based route protection
